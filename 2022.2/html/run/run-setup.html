<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>3.1. Board and System settings &mdash; Versal PCIe TRD 2022.2 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.2. Run the PCIe TRD Dashboard" href="run-dashboard.html" />
    <link rel="prev" title="3. Run the Prebuilt Image" href="../run.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../index.html" class="icon icon-home"> Versal PCIe TRD
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../revision.html">1. Revision History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">2. Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../run.html">3. Run the Prebuilt Image</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.1. Board and System settings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">3.1.1. Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reference-design-sd-card-creation">3.1.2. Reference Design SD Card Creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#system-controller">3.1.3. System Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="#board-setup">3.1.4. Board Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#host-machine-software-setup">3.1.5. Host Machine Software setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#updating-the-pcie-device-id-if-needed">3.1.5.1. Updating the PCIe device ID (if needed)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#generation-of-raw-video-input-file">3.1.5.2. Generation of Raw video Input file</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="run-dashboard.html">3.2. Run the PCIe TRD Dashboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="run-filter2d.html">3.3. Run 2D Filter Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="run-xvdpu.html">3.4. Run XVDPU application</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../build.html">4. Build an Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arch.html">5. Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../known-issues.html">6. Known Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">7. Support</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Versal PCIe TRD</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../run.html"><span class="section-number">3. </span>Run the Prebuilt Image</a> &raquo;</li>
      <li><span class="section-number">3.1. </span>Board and System settings</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/run/run-setup.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="board-and-system-settings">
<span id="id1"></span><h1><span class="section-number">3.1. </span>Board and System settings<a class="headerlink" href="#board-and-system-settings" title="Permalink to this heading">¶</a></h1>
<section id="prerequisites">
<h2><span class="section-number">3.1.1. </span>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Prebuilt SD Image zip file</p></li>
<li><p>Terminal emulator, for example</p>
<ul>
<li><p>Windows: teraterm (<a class="reference external" href="https://osdn.net/projects/ttssh2">https://osdn.net/projects/ttssh2</a>)</p></li>
<li><p>Linux: picocom (<a class="reference external" href="https://github.com/npat-efault/picocom/releases">https://github.com/npat-efault/picocom/releases</a>)</p></li>
</ul>
</li>
<li><p>Windows: Win32 Disk Imager utility (<a class="reference external" href="https://sourceforge.net/projects/win32diskimager">https://sourceforge.net/projects/win32diskimager</a>)</p></li>
<li><p>Windows: 7zip utility (<a class="reference external" href="https://sourceforge.net/projects/sevenzip/">https://sourceforge.net/projects/sevenzip/</a>)</p></li>
</ul>
</section>
<section id="reference-design-sd-card-creation">
<span id="id2"></span><h2><span class="section-number">3.1.2. </span>Reference Design SD Card Creation<a class="headerlink" href="#reference-design-sd-card-creation" title="Permalink to this heading">¶</a></h2>
<p>The reference design prebuilt SD image zip file can be downloaded from the below location.</p>
<table class="docutils align-default" id="id5">
<caption><span class="caption-text"><strong>Table 1: SD Image zip files</strong></span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50.0%" />
<col style="width: 25.0%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Platform</p></th>
<th class="head"><p>2D filter</p></th>
<th class="head"><p>XVDPU</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>vck190_mipiRxSingle_hdmiTx</p></td>
<td><p><a class="reference external" href="https://www.xilinx.com/member/forms/download/trd-license-versal.html?filename=vck190_pcie_trd_filter2d_2022_2_prebuilt.zip#">vck190_pcie_trd_filter2d_prebuilt</a></p></td>
<td><p><a class="reference external" href="https://www.xilinx.com/member/forms/download/trd-license-versal.html?filename=vck190_pcie_trd_xvdpu_2022_2_prebuilt.zip#">vck190_pcie_trd_xvdpu_prebuilt</a></p></td>
</tr>
</tbody>
</table>
<p>Unzip the downloded file. This should contain the zipped wic image <code class="docutils literal notranslate"><span class="pre">petalinux-sdimage.wic.xz</span></code>
and a readme file pointing to Third party licenses and sources associated with this image.</p>
<p>Choose an unpartitioned SD card of size 8GB or greater for this demo. Use the
<em>Win32 Disk Imager</em> utility for Windows or ‘dd’ command line utility for Linux
to write the given raw disk image <code class="docutils literal notranslate"><span class="pre">petalinux-sdimage.wic</span></code> to the SD card.</p>
<p>After unzipping the image file <code class="docutils literal notranslate"><span class="pre">petalinux-sdimage.wic.xz</span></code> using the 7zip
utility on Windows, use the following steps to write a raw disk image to a
removable device using the Win32 Disk Imager utility.</p>
<ol class="arabic">
<li><p>Browse to the location of the unzipped image in the Win32 utility. In the
‘File name’ field, type <code class="docutils literal notranslate"><span class="pre">*.wic</span></code>, otherwise only files with the <code class="docutils literal notranslate"><span class="pre">.img</span></code>
ending file be shown. Alternatively, change the drop down menu on the bottom
right from ‘Disk Images (*.img *.IMG)’ to ‘*.*’.</p></li>
<li><p>Choose the correct SD card drive letter under ‘Device’</p></li>
<li><p>Select ‘Write’ to the SD card, click ‘Yes’ at the prompt to continue writing
and wait till the operation is complete</p>
<a class="reference internal image-reference" href="../_images/win32.jpg"><img alt="Win32 Image" src="../_images/win32.jpg" style="width: 500px;" /></a>
</li>
</ol>
<p>Steps to write a raw disk image to a removable device using dd command-line
utility for Linux</p>
<ol class="arabic">
<li><p>unzip the given image file <code class="docutils literal notranslate"><span class="pre">petalinux-sdimage.wic.xz</span></code> in linux</p></li>
<li><p>Use dd to write <code class="docutils literal notranslate"><span class="pre">petalinux-sdimage.wic</span></code> to correct enumerated disk for SD
card in the Linux machine:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>unxz<span class="w"> </span>petalinux-sdimage.wic.xz
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>petalinux-sdimage.wic<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/dev/sdbx<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>1M
</pre></div>
</div>
</li>
</ol>
<p><strong>SD card partitions</strong></p>
<p>Once the raw image is written to the SD card, you will be able to see two
partitions. The first partition (FAT16 format) is the boot partition and it
contains:</p>
<ul class="simple">
<li><p>Xilinx OpenCL binary container (<code class="docutils literal notranslate"><span class="pre">binary_container_1.xclbin</span></code>)</p></li>
<li><p>Boot image (<code class="docutils literal notranslate"><span class="pre">BOOT.BIN</span></code>)</p></li>
<li><p>u-boot boot script (<code class="docutils literal notranslate"><span class="pre">boot.scr</span></code>)</p></li>
<li><p>Linux kernel image (<code class="docutils literal notranslate"><span class="pre">image.ub</span></code>)</p></li>
<li><p>Initial filesystem in ramdisk (<code class="docutils literal notranslate"><span class="pre">ramdisk.cpio.gz.u-boot</span></code>)</p></li>
</ul>
<p>while in the second patition (ext4 format) resides the root file system.</p>
<p><strong>Note:</strong> A Windows OS would only allow FAT16 partitions to be viewed whereas
the ext4 format is not recognized.</p>
</section>
<section id="system-controller">
<h2><span class="section-number">3.1.3. </span>System Controller<a class="headerlink" href="#system-controller" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you think that you have the correct System Controller (SC) SD Image then this section
can be skipped.</p>
</div>
<p><strong>Production Silicon</strong></p>
<p>The image (Beta  2.1) and instructions to write to SC SD card are avaialble on the Beam Tool page</p>
<ul class="simple">
<li><p>SC SD Image: <a class="reference external" href="https://www.xilinx.com/member/forms/download/xef.html?filename=intermediate_petalinux-sdimage.zip">https://www.xilinx.com/member/forms/download/xef.html?filename=intermediate_petalinux-sdimage.zip</a></p></li>
<li><p>Instructions: <a class="reference external" href="http://wiki.xilinx.com/BEAM+Tool+for+VCK190+Evaluation+Kit">http://wiki.xilinx.com/BEAM+Tool+for+VCK190+Evaluation+Kit</a></p></li>
</ul>
</section>
<section id="board-setup">
<span id="id3"></span><h2><span class="section-number">3.1.4. </span>Board Setup<a class="headerlink" href="#board-setup" title="Permalink to this heading">¶</a></h2>
<p>The following figure shows how to set up the VCK190 evaluation board.</p>
<a class="reference internal image-reference" href="../_images/vck190-setup.png"><img alt="VCK190 Board Setup" src="../_images/vck190-setup.png" style="width: 900px;" /></a>
<p><strong>Board jumper and switch settings</strong></p>
<p>This is a onetime setup and the board should have been delivered to you with
this default settings, but it is good to double check for the first time when
you get the board.</p>
<ul class="simple">
<li><p>Make sure you remove J326 (7-8) jumper.</p></li>
<li><p>Setup SYSCTRL Boot mode switch SW11 to (ON,OFF,OFF,OFF) from switch bits
1 to 4 as shown in the above picture.</p></li>
<li><p>Make sure you have the SYSCTRL uSD card inserted in the slot and card has the
SYSCTRL image.</p></li>
<li><p>Setup Versal Boot Mode switch SW1 to (ON,OFF,OFF,OFF) from switch bits 1 to 4
as shown in the above picture.</p></li>
</ul>
<p><strong>MIPI and HDMI connections</strong></p>
<p>The platform supports video capture from the Leopard IMX274 MIPI FMC.
Connect the FMC card to the FMCP1 slot (J51) as shown in the above figure.
For more info on the FMC module, visit:
<a class="reference external" href="https://www.leopardimaging.com/uploads/LI-IMX274MIPI-FMC_datasheet.pdf">https://www.leopardimaging.com/uploads/LI-IMX274MIPI-FMC_datasheet.pdf</a>.
The platform supports video display via HDMI Tx.  Connect the HDMI cable as shown in the above figure.
Connect the other end of the cable to a HDMI port in the monitor.</p>
<p><strong>PCI express connections</strong></p>
<p>The platform supports video file input from the host machine via
PCIe EndPoint 8-lane edge connector (P3) as shown in the above figure.
The platform also supports video dispaly via PCIe on a monitor (DP) connected to the
host machine.</p>
<p><strong>Serial console settings</strong></p>
<p>VCK190 comes with a USB-C connector for JTAG+UART, when connected three UART
ports should be visible in Device Manager:</p>
<ul class="simple">
<li><p>Versal UART0</p></li>
<li><p>Versal UART1 &amp;</p></li>
<li><p>System Controller UART</p></li>
</ul>
<p>Connect a USB-C cable to the USB-UART connector. Open two terminal emulator windows. Choose
Versal UART0 on one and System Controller UART on the other and use the following settings
on the Serial Port:</p>
<ul class="simple">
<li><p>Baud Rate: 115200</p></li>
<li><p>Data: 8 bit</p></li>
<li><p>Parity: None</p></li>
<li><p>Stop: 1 bit</p></li>
<li><p>Flow Control: None</p></li>
</ul>
<p><strong>Vadj settings</strong></p>
<p>Perform the following steps to set the Vadj voltage rail to 1.2V using the
<em>BoardUI/Board Interface Test(BIT)</em> utility:</p>
<ol class="arabic">
<li><p>Power on the board.</p></li>
<li><p>On the  System Controller UART terminal type the following commands at
the linux prompt. This will allow the <em>BoardUI/Board Interaface Test</em> utility
to communicate with the System Controller. For more information refer to
<a class="reference external" href="http://wiki.xilinx.com/BEAM+Tool+for+VCK190+Evaluation+Kit">http://wiki.xilinx.com/BEAM+Tool+for+VCK190+Evaluation+Kit</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>EXT&lt;Enter<span class="w"> </span>key&gt;&lt;Tab<span class="w"> </span>Key&gt;
sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/^#//&#39;</span><span class="w"> </span>/etc/init.d/start_boardframework.sh
/etc/init.d/start_boardframework.sh
</pre></div>
</div>
</li>
<li><p>Close the System Controller UART terminal</p></li>
<li><p>Download the <em>BoardUI/Board Interface Test(BIT)</em> tool from the following link:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.xilinx.com/member/forms/download/design-license.html?cid=b83eede2-f9d2-4e81-a393-67a1a8ba609e&amp;filename=rdf0574-vck190-bit-c-2020-2.zip">VCK190 Board Interface Test : rdf0574-vck190-bit-c-2020-2.zip</a></p></li>
</ul>
</li>
<li><p>Extract the zip file and start the <em>BoardUI/Board Interface Test(BIT)</em> tool
by clicking on <em>BoardUI.exe</em>. Make sure the USB-C
cable is connected to your PC and the system controller Micro SD card is
inserted. Also make sure you Vivado Design Suite HW Manager is installed on
the host machine.</p></li>
<li><p>In the <em>BoardUI</em> GUI, navigate to the <em>FMC Boot Up</em> tab following the red
circles as shown in the below figure. Enter <em>1.2</em> in the <em>Set On-Boot VADJ</em>
field and click the button next to it to save the value.</p>
<a class="reference internal image-reference" href="../_images/boardui.jpg"><img alt="BoardUI Utility" src="../_images/boardui.jpg" style="width: 900px;" /></a>
</li>
<li><p>Power-cycle the board and navigate to the <em>FMC Current</em> tab. Click the
<em>Get VADJ_FMC Voltage</em> button to read out the current voltage setting and
confirm it matches the 1.2V set in the previous step.</p></li>
<li><p>Close the <em>BoardUI</em> utility.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If Vadj does not persists after reboot, try updating the System Controller
SD card image (Instructions provided in the System Controller section of
this tutorial).</p>
</div>
<p><strong>First Boot</strong></p>
<p>Follow these steps to boot the board into Linux</p>
<ol class="arabic">
<li><p>Ensure all steps under the section <a class="reference internal" href="#board-setup"><span class="std std-ref">Board Setup</span></a> are verified.</p></li>
<li><p>Insert the prepared micro SD card into the Versal SD card slot (refer to the
image in <a class="reference internal" href="#reference-design-sd-card-creation"><span class="std std-ref">Reference Design SD Card Creation</span></a>)</p></li>
<li><p>Have the UART0 terminal emulator tab connected.</p></li>
<li><p>Turn ON power switch SW13.</p></li>
<li><p>On Versal UART0 terminal, you would see the Versal device booting from the
micro SD card, starting with the message
“Xilinx Versal Platform Loader and Manager”</p></li>
<li><p>In about 60 seconds boot is complete. Observe the Linux prompt to login and set a new password as shown below.
Use ‘petalinux’ as login name and set an easy password that you do not forget. Use this password when you boot
again or when using sudo.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xilinx-vck190-20222<span class="w"> </span>login:<span class="w"> </span>petalinux
You<span class="w"> </span>are<span class="w"> </span>required<span class="w"> </span>to<span class="w"> </span>change<span class="w"> </span>your<span class="w"> </span>password<span class="w"> </span>immediately<span class="w"> </span><span class="o">(</span>administrator<span class="w"> </span>enforced<span class="o">)</span>.
New<span class="w"> </span>password:
Retype<span class="w"> </span>new<span class="w"> </span>password:
</pre></div>
</div>
</li>
</ol>
</section>
<section id="host-machine-software-setup">
<span id="id4"></span><h2><span class="section-number">3.1.5. </span>Host Machine Software setup<a class="headerlink" href="#host-machine-software-setup" title="Permalink to this heading">¶</a></h2>
<p><strong>Directory and file description</strong></p>
<p>Following are the list of directories in <cite>pcie_host_package</cite> directory.</p>
<ul class="simple">
<li><p><strong>apps</strong>: QDMA User space application to configure and control QDMA</p></li>
<li><p><strong>docs</strong>: Documentation for the Xilinx QDMA Linux Driver</p></li>
<li><p><strong>driver/src</strong>: Provides interfaces to manage the PCIe device and exposes character driver interface to perform QDMA transfers</p></li>
<li><p><strong>driver/libqdma</strong>: QDMA library to configure and control the QDMA IP</p></li>
<li><p><strong>scripts</strong>: Sample scripts for perform DMA operations</p></li>
<li><p><strong>Makefile</strong>: Makefile to compile the driver</p></li>
<li><p><strong>pcie_app</strong>: This application receives frame buffer data from host, processes it and sends frame buffer to host using QDMA driver</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure, the VCK190 board is powered on before booting the HOST machine to enumerate VCK190 board as PCIe endpoint device successfully</p>
</div>
<ol class="arabic">
<li><p>Power on the HOST machine</p></li>
<li><p>Execute following command on HOST machine’s terminal to check If the Board is linking up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lspci<span class="w"> </span>-vd<span class="w"> </span>10ee:
</pre></div>
</div>
</li>
<li><p>On successful Linkup below entry appears followed by additional capabilities of VCK190 as endpoint:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">03</span>:00.0<span class="w"> </span>RAM<span class="w"> </span>memory:<span class="w"> </span>Xilinx<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>b03f
</pre></div>
</div>
</li>
<li><p>If above entry is missing QDMA driver will not be able to recognized PCIe endpoint device.</p></li>
<li><p>If not already done, copy <cite>pcie_host_package</cite> directory to PCIe host machine.</p></li>
</ol>
<section id="updating-the-pcie-device-id-if-needed">
<h3><span class="section-number">3.1.5.1. </span>Updating the PCIe device ID (if needed)<a class="headerlink" href="#updating-the-pcie-device-id-if-needed" title="Permalink to this heading">¶</a></h3>
<p>Make sure that PCIe Device ID in the driver is matching to Device ID observed in linkup status. in above output <cite>b03f</cite> is device ID.</p>
<p>During the PCIe DMA IP customization in Vivado you can specify a PCIe Device ID. This Device ID must be recognized by the driver in order to properly identify the PCIe QDMA device.</p>
<p>To Check/modify the PCIe Device ID in the driver, open the <cite>$vck190-pcie-trd/pcie_host_package/qdma/driver/src/pci_ids.h</cite> file (line no : 320) from the driver source and search for the pcie_device_id struct.
This struct defines the PCIe Device IDs that are recognized by the driver in the following format:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>PCI_DEVICE<span class="w"> </span><span class="o">(</span>0x10ee,<span class="w"> </span>0xb03f<span class="o">)</span>,<span class="o">}</span>,
</pre></div>
</div>
</div></blockquote>
<p>Add, remove, or modify the PCIe Device IDs in this struct. The PCIe DMA driver will only recognize device IDs identified in this struct as PCIe QDMA devices. User can also remove PCIe Device IDs that are not be used in their solution.
On every modification, the driver must be un-installed and recompiled, if compiled previously.</p>
<p>For additional information refer <a class="reference external" href="https://xilinx.github.io/dma_ip_drivers/master/QDMA/linux-kernel/html/build.html">https://xilinx.github.io/dma_ip_drivers/master/QDMA/linux-kernel/html/build.html</a></p>
<p>Follow below steps to Install the QDMA driver</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Root permissions will be required to install qdma driver.</p>
</div>
<ol class="arabic">
<li><p>Build the QDMA driver</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="nb">cd</span><span class="w"> </span>pcie_host_package/qdma
make
</pre></div>
</div>
</li>
<li><p>Install the QDMA driver</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>install-mods
</pre></div>
</div>
</li>
<li><p>Configure the QDMA module paramters using following script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./scripts/qdma_generate_conf_file.sh<span class="w"> </span>&lt;bus_num&gt;<span class="w"> </span>&lt;num_pfs&gt;<span class="w"> </span>&lt;mode&gt;<span class="w"> </span>&lt;config_bar&gt;<span class="w"> </span>&lt;master_pf&gt;<span class="sb">`</span>
</pre></div>
</div>
<p>Ex: (Assuming PCIe BDF - 03:00.0)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./scripts/qdma_generate_conf_file.sh<span class="w"> </span>0x03<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
</li>
<li><p>For loading the driver, execute the following command: (This is required only First time, from next boot driver loads automatically)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>modprobe<span class="w"> </span>qdma-pf
</pre></div>
</div>
</li>
<li><p>Setup and Enable Queues for H2C and C2H:  (Refer link in NOTE_1 for more details)
Allocate the Queues to a function. QDMA IP supports maximum of 2048 queues.
By default, all functions have 0 queues assigned.
qmax configuration parameter enables the user to update the number of queues for a PF.
This configuration parameter indicates “Maximum number of queues associated for the current pf”.</p></li>
<li><p>To set 1024 as qmax for PF0:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="m">1024</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/bus/pci/drivers/qdma-pf/<span class="nv">$BDF</span>/qdma/qmax
</pre></div>
</div>
</li>
<li><p>To Add a Queue:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dma-ctl<span class="w"> </span>qdma&lt;bbddf&gt;<span class="w"> </span>q<span class="w"> </span>add<span class="w"> </span>idx<span class="w"> </span>&lt;N&gt;<span class="w"> </span><span class="o">[</span>mode<span class="w"> </span>&lt;st<span class="p">|</span>mm&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>dir<span class="w"> </span>&lt;h2c<span class="p">|</span>c2h<span class="p">|</span>bi&gt;<span class="o">]</span>
</pre></div>
</div>
<p>Ex: (Assuming PCIe BDF - 03:00.0)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>dma-ctl<span class="w"> </span>qdma03000<span class="w"> </span>q<span class="w"> </span>add<span class="w"> </span>idx<span class="w"> </span><span class="m">0</span><span class="w"> </span>mode<span class="w"> </span>mm<span class="w"> </span>dir<span class="w"> </span>h2c
dma-ctl<span class="w"> </span>qdma03000<span class="w"> </span>q<span class="w"> </span>add<span class="w"> </span>idx<span class="w"> </span><span class="m">1</span><span class="w"> </span>mode<span class="w"> </span>mm<span class="w"> </span>dir<span class="w"> </span>c2h
</pre></div>
</div>
</li>
<li><p>To start a Queue:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dma-ctl<span class="w"> </span>qdma&lt;bbddf&gt;<span class="w"> </span>q<span class="w"> </span>start<span class="w"> </span>idx<span class="w"> </span>&lt;N&gt;<span class="w"> </span><span class="o">[</span>dir<span class="w"> </span>&lt;h2c<span class="p">|</span>c2h<span class="p">|</span>bi&gt;<span class="o">]</span>
</pre></div>
</div>
<p>Ex: (Assuming PCIe BDF - 03:00.0)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>dma-ctl<span class="w"> </span>qdma03000<span class="w"> </span>q<span class="w"> </span>start<span class="w"> </span>idx<span class="w"> </span><span class="m">0</span><span class="w"> </span>dir<span class="w"> </span>h2c
dma-ctl<span class="w"> </span>qdma03000<span class="w"> </span>q<span class="w"> </span>start<span class="w"> </span>idx<span class="w"> </span><span class="m">1</span><span class="w"> </span>dir<span class="w"> </span>c2h
</pre></div>
</div>
</li>
<li><p>Build host application:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>pcie_app/
</pre></div>
</div>
</li>
<li><p>Modify macros <cite>H2C_DEVICE</cite> , <cite>C2H_DEVICE</cite> , <cite>REG_DEVICE_NAME</cite> in pcie_host.cpp , using /dev/ nodes generated for  the pcie device based on its <cite>Bus:Device:Function number</cite>.</p>
<p>Ex: Assuming PCIe BDF as <cite>03:00.0</cite> the above macros need to be set as</p>
<blockquote>
<div><ul class="simple">
<li><p>If H2C queue index is 0 device node is <cite>/dev/qdma03000-MM-0</cite>  (Queue index for H2C is set in above “Add a queue” step)</p></li>
<li><p>If C2H queue index is 1 device node is <cite>/dev/qdma03000-MM-1</cite>  (Queue index for C2H is set in above “Add a queue” step)</p></li>
</ul>
</div></blockquote>
<p>REG_DEVICE_NAME is <cite>/sys/bus/pci/devices/0000:03:00.0/resource0</cite></p>
</li>
<li><p>Modify pcie_app/app1.pro line no 35 and 39 for opencv library path and opencv include path before compilation</p></li>
<li><p>set <cite>QMAKE_PATH</cite> to installed QT qmake path</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">QMAKE_PATH</span><span class="o">=</span>/opt/Qt5.9/5.9/gcc_64/bin/qmake<span class="sb">`</span>
</pre></div>
</div>
</li>
<li><p>compile application:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./do_compile.sh
</pre></div>
</div>
</li>
</ol>
</section>
<section id="generation-of-raw-video-input-file">
<h3><span class="section-number">3.1.5.2. </span>Generation of Raw video Input file<a class="headerlink" href="#generation-of-raw-video-input-file" title="Permalink to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ensure that Gstreamer packages installed on the Linux PC. If using Ubuntu distribution, ensure that the version is atleast 16.04.</p>
</div>
<ol class="arabic">
<li><p>Download VP9 encoded sample file such as [Big_Buck_Bunny](<a class="reference external" href="https://upload.wikimedia.org/wikipedia/commons/transcoded/c/c0/Big_Buck_Bunny_4K.webm/Big_Buck_Bunny_4K.webm.480p.vp9.webm">https://upload.wikimedia.org/wikipedia/commons/transcoded/c/c0/Big_Buck_Bunny_4K.webm/Big_Buck_Bunny_4K.webm.480p.vp9.webm</a>)</p></li>
<li><p>Run following GST command to create 3840x2160 resolution raw file with YUY2 format with 30fps</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0<span class="w"> </span>filesrc<span class="w"> </span><span class="nv">location</span><span class="o">=</span>&lt;file_path&gt;/Big_Buck_Bunny_4K.webm.480p.vp9.webm<span class="w"> </span>!<span class="w"> </span>decodebin<span class="w"> </span>!<span class="w"> </span>queue<span class="w"> </span>!<span class="w"> </span>videoconvert<span class="w"> </span>!<span class="w"> </span>videoscale<span class="w"> </span>!<span class="w"> </span>videorate<span class="w"> </span>!<span class="w"> </span>video/x-raw,<span class="w"> </span><span class="nv">width</span><span class="o">=</span><span class="m">3840</span>,<span class="w"> </span><span class="nv">height</span><span class="o">=</span><span class="m">2160</span>,<span class="w"> </span><span class="nv">format</span><span class="o">=</span>YUY2,<span class="w"> </span><span class="nv">framerate</span><span class="o">=</span><span class="m">30</span>/1<span class="w"> </span>!<span class="w"> </span>filesink<span class="w"> </span><span class="nv">location</span><span class="o">=</span>&lt;file_path&gt;/4k30.yuv
</pre></div>
</div>
</li>
<li><p>Run following GST command to create 1920x1080 resolution raw file with YUY2 format with 30fps</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0<span class="w"> </span>filesrc<span class="w"> </span><span class="nv">location</span><span class="o">=</span>&lt;file_path&gt;/Big_Buck_Bunny_4K.webm.480p.vp9.webm<span class="w"> </span>!<span class="w"> </span>decodebin<span class="w"> </span>!<span class="w"> </span>queue<span class="w"> </span>!<span class="w"> </span>videoconvert<span class="w"> </span>!<span class="w"> </span>videoscale<span class="w"> </span>!<span class="w"> </span>videorate<span class="w"> </span>!<span class="w"> </span>video/x-raw,<span class="w"> </span><span class="nv">width</span><span class="o">=</span><span class="m">1920</span>,<span class="w"> </span><span class="nv">height</span><span class="o">=</span><span class="m">1080</span>,<span class="w"> </span><span class="nv">format</span><span class="o">=</span>YUY2,<span class="w"> </span><span class="nv">framerate</span><span class="o">=</span><span class="m">30</span>/1<span class="w"> </span>!<span class="w"> </span>filesink<span class="w"> </span><span class="nv">location</span><span class="o">=</span>&lt;file_path&gt;/1080p30.yuv
</pre></div>
</div>
</div></blockquote>
<hr class="docutils" />
<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not use this file
except in compliance with the License.</p>
<p>You may obtain a copy of the License at
<a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the
License is distributed on an “AS IS” BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
either express or implied. See the License for the specific language governing permissions
and limitations under the License.</p>
</section>
</section>
</section>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../run.html" class="btn btn-neutral float-left" title="3. Run the Prebuilt Image" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="run-dashboard.html" class="btn btn-neutral float-right" title="3.2. Run the PCIe TRD Dashboard" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023-2023, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on May 19, 2023.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>